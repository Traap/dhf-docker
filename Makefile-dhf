# Makefile for DHF Document Builds

AMBER       := /opt/dhf/repos/amber
AUTODOC     := /opt/dhf/repos/autodoc
DOCBLD      := /opt/dhf/repos/docbld
DOCKER_RAKE := docker compose run --rm -w /opt/dhf/repos/docbld dhf-builder rake
EXPORTDIR   := /exports
NEWDOC      := /opt/dhf/repos/newdoc
TLCDIR      := /opt/dhf/repos/tlc-article

all: deploy ## Build the full DHF (delegates to deploy)

clobber: ## Remove generated files and intermediate artifacts
	$(DOCKER_RAKE) clobber

copy_files: ## Copy generated files into the distribution folder
	$(DOCKER_RAKE) copy_files

deploy: remove_distdir texx copy_files clobber ## Full docbld pipeline: clean â†’ build â†’ copy â†’ clobber

docx: ## Build DOCX files from .texx using docbld
	$(DOCKER_RAKE) docx

help: ## Show this help message
	@echo "ðŸ“š Available Make targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

list_files: ## List all .texx files detected by docbld
	$(DOCKER_RAKE) list_files

remove_distdir: ## Remove the distribution directory
	$(DOCKER_RAKE) remove_distdir

texx: ## Build PDFs from .texx using docbld
	$(DOCKER_RAKE) texx

.PHONY: all clobber copy_files deploy docx help list_files remove_distdir texx

